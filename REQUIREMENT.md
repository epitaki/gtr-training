# REQUIREMENT.md

GTRトレーニングツールの要件定義書

## プロジェクト概要

パズルゲーム「ぷよぷよ」における重要な連鎖の土台形「GTR（グレート田中連鎖）」を、ゲームとして楽しみながら習得できるトレーニングツールを開発する。

## 基本要件

### GTRとは
- ぷよぷよにおける効率的な連鎖の土台形の一つ
- **必ず折り返し部分を持つ**（折り返しのないGTRは存在しない）
- 2-3列目の特定の形状（折り返し部分）+ 4列目以降の連鎖尾で構成
- 初心者から上級者まで幅広く使用される定番の形
- 本ツールでは**基本GTR**と**1列目拡張GTR**のみを対象とする（**逆折りGTRは対象外**）

### ぷよぷよゲームの基本仕様
- フィールドサイズ：横6列×縦12段（見える部分）+ 縦1段（13段目は見えない）
- ぷよの色：4色固定（赤・緑・青・黄）
- **2手目組み合わせ制約**: AAAA型、AAAB型、ABAB型(AABB型)、ABAC型、AABC型の5種類のみ、4色全てが揃うことはない
- 連鎖の条件：同じ色のぷよが4つ以上つながると消える
- 重力：ぷよは下に落ちる

## 機能要件

### 1. 実装済み機能

#### 1.1 ゲームモード管理・UI構成
- **SPA構成（2024年11月実装）**
  - ヘッダー + サイドメニュー + コンテンツエリアの3領域構成
  - ヘッダー：サイトロゴ（クリックでTOP画面に戻る）、アカウントアイコン
  - サイドメニュー：常時表示のモード選択UI
  - コンテンツエリア：選択モードに応じて動的に切り替わる

- **TOPページ**
  - GTRの説明とゲーム紹介
  - 各モードへのクイックアクセスボタン
  - 開発予定機能の案内

- **実装済みゲームモード**
  - 初心者用ガイド付きGTR練習（GuidedPracticeScene）
  - GTRスコアアタック（PuyoGame）

- **未実装モード（メニュー表示済み）**
  - 対戦モード
  - 統計情報

#### 1.2 初心者用ガイド付きGTR練習
- **ガイド表示システム**
  - 右側にガイド表示エリアを配置（800x800px）
  - 状態遷移：最初の2手 → 基本形 → 連鎖尾 → 完成形
  - 2手組み合わせパターン別おすすめ配置
  
- **学習支援機能**
  - ↑キー：巻き戻し機能（1手戻る）
  - Pキー：ポーズ/再開
  - リアルタイムガイド更新
  
- **詳細評価システム**
  - SpaceキーでGTR評価実行
  - チェックボックス形式で詳細結果表示
  - 折り返し、連鎖尾タイプ、連鎖数、あまりぷよの評価
  - Space/Escキーで続行/終了選択

#### 1.3 GTRスコアアタック
- **高速ゲームプレイ**
  - 従来の5GTRモードを維持（600x800px）
  - SpaceキーでGTR評価実行
  - インタラクティブな評価画面
  - Space（続行）/Esc（終了）選択

#### 1.4 基本ゲームシステム
- **2手目組み合わせ制約**
  - AAAA型、AAAB型、ABAB型、ABAC型、AABC型の5種類のみ
  - 4色全てが揃うことはない現実的な制約
  - 4色固定（赤・緑・青・黄）
  
- **GTR評価システム**
  - 必須折り返しパターンの検出（1-3列目）
  - 連鎖尾形状の判定（Y字・L字・階段型）
  - 評価点数設定ファイル分離でチューニング容易
  
- **操作システム**
  - 壁キック実装（回転時の壁際補正）
  - EscキーでTOPページに戻る機能
  - ネクスト・ネクネクスト表示

### 2. 今後の開発予定機能

#### 2.1 フリープレイモード
- **ガイドなしGTR練習**
  - 自由なGTR構築練習
  - 完成したGTRの采点機能
  - 統計情報表示

#### 2.2 学習支援機能の強化

#### 2.3 対象GTRパターン
本ツールで習得対象とするGTRの形状：

##### 基本GTR（必須折り返し部分） - ✅実装済み
- 1-3列目の必須形状：折り返しパターン
- 連鎖尾は主に4-6列目に配置
- すべてのGTRに共通する基本形
- 必須形状：
```
   123
10 AB
11 AAB  
12 BB
```

##### 連鎖尾の形状 - ✅実装済み
- **Y字形**：3-5列目が同じ高さで、それぞれ3段以上
- **L字形**：3-4列目が高く、5列目が低い
- **階段形**：列が順に高くなるまたは低くなる

##### 1列目拡張GTR - ✅部分実装
- 基本GTR + 1列目の縦積み
- より多くの連鎖が期待できる発展形

##### 対象外パターン
- **逆折りGTR**：複雑すぎるため対象外
- **変則GTR**：基本習得を優先するため対象外
- **多重折り返し**：上級者向けのため対象外

##### チュートリアルモード
- 手順を一つずつ説明しながらGTRを組む
- ミスをしても巻き戻し可能
- 各ステップでの詳細説明
- 練習問題付き

##### ガイド付きプレイ
- 通常のゲームプレイにGTRガイドを重ねて表示
- 徐々にガイドを薄くしていく段階的学習
- 難易度調整機能

##### フリープレイ
- ガイドなしでGTRを組む練習
- 完成したGTRの採点機能付き
- 自由練習モード

##### GTRスコアアタック
- 決められた回数のGTRを組む速度を競うモード
- カテゴリー：5回、10回、20回のGTR完成
- 評価基準：
  - 完成速度（メインスコア）
  - GTRの精度（ボーナスポイント）
  - ミスの少なさ（減点要素）
- タイムとスコアの両方を記録

### 2. ランキングシステム

#### 2.1 グローバルランキング
- 全ユーザーのスコアアタック記録を表示
- 期間別ランキング：
  - デイリーランキング
  - ウィークリーランキング
  - マンスリーランキング
  - オールタイムランキング
- GTR完成回数別のカテゴリー分け

#### 2.2 パーソナルレコード
- 個人のベストタイム記録
- 成長グラフの表示
- 自己記録更新時の特別演出
- プレイ履歴の保存

#### 2.3 ランキング表示内容
- ユーザー名
- 完成タイム
- スコア
- 達成日時
- 国/地域（オプション）
- リプレイ再生機能

### 3. ゲーム性を高める要素

#### 3.1 報酬システム
- スコアシステム：正確なGTR構築に対する得点
- 実績・バッジシステム：
  - 初めてのGTR完成
  - 連続成功回数
  - スピード記録
  - 累計プレイ時間
- アンロック要素：
  - 新しいぷよスキン
  - 背景テーマ
  - 効果音セット

#### 3.2 サポート機能
- ヒント機能（使用回数に応じてスコア調整）
- リプレイ機能：
  - 自分のプレイを録画・再生
  - 上位プレイヤーの手順を学習
  - スロー再生機能
- 統計情報：
  - 成功率
  - 平均完成時間
  - よくあるミスパターン

## 野望的機能（将来実装）

### オンライン対戦モード

#### リアルタイム対戦
- **1対1 GTRスピードバトル**
  - 同時にGTRを組み始め、完成速度を競う
  - 相手の進捗がリアルタイムで見える
  - 先に指定回数のGTRを完成させた方が勝利
  - 妨害要素の追加（オプション）

- **トーナメントモード**
  - 4人、8人、16人でのトーナメント形式
  - 勝ち抜き戦
  - リーグ戦
  - 定期的な公式大会の開催
  - シーズン制とランク報酬

- **協力モード**
  - 2人で交互にぷよを置いてGTRを完成させる
  - チームワークと理解度が試される
  - 協力スコアの記録

#### 対戦機能の要素
- マッチメイキングシステム：
  - スキルレベル別マッチング
  - レート制度
  - カジュアル/ランクマッチ
- 観戦モード：
  - 他プレイヤーの対戦を観戦
  - コメント機能
  - 配信モード対応
- ソーシャル機能：
  - フレンドリスト
  - プライベートルーム
  - ギルド/チーム機能
- コミュニケーション：
  - 定型文チャット
  - スタンプ/エモート
  - 対戦後の握手機能
- 対戦記録：
  - 対戦履歴
  - 詳細統計
  - ハイライト自動生成

## 非機能要件

### 動作環境
- **プライマリプラットフォーム**：PCブラウザ
  - インストール不要（ブラウザで直接プレイ可能）
  - 推奨ブラウザ：Chrome、Firefox、Safari、Edge（最新版）
  - 最小画面解像度：1280×720
  - 推奨画面解像度：1920×1080

- **セカンダリプラットフォーム**：モバイルブラウザ
  - iOS Safari（iOS 14以降）
  - Android Chrome（Android 8以降）
  - レスポンシブデザイン対応
  - タッチ操作最適化

### パフォーマンス
- 60FPS での安定動作
- 低遅延な入力レスポンス（<16ms）
- 軽量なアプリケーションサイズ（初回ロード < 5MB）
- 追加アセットの遅延読み込み

### 互換性
- クロスプラットフォーム対応：
  - PCブラウザ（Chrome、Firefox、Safari、Edge）
  - モバイルブラウザ（iOS Safari、Android Chrome）
  - Progressive Web App（PWA）対応でオフラインプレイ可能

### アクセシビリティ
- カラーブラインドモード
- キーボード/ゲームパッド対応
- 音声ガイド（オプション）

### セキュリティ
- ユーザーデータの暗号化
- セキュアな通信（HTTPS）
- チート対策

## 技術要件

### 推奨技術スタック
- フロントエンド：モダンなWebフレームワーク
- ゲームエンジン：軽量で高速なもの
- バックエンド：スケーラブルなAPI
- データベース：ランキング・ユーザーデータ管理
- リアルタイム通信：WebSocket（対戦機能用）

### 開発優先順位
1. **Phase 1（MVP）**：基本的なGTR学習機能
   - チュートリアルモード
   - ガイド付きプレイ
   - 基本的なスコアシステム

2. **Phase 2**：競争要素の追加
   - スコアアタック
   - ローカルランキング
   - 実績システム

3. **Phase 3**：オンライン機能
   - グローバルランキング
   - リプレイ共有
   - ユーザープロフィール

4. **Phase 4**：対戦機能
   - 1対1対戦
   - トーナメント
   - ソーシャル機能