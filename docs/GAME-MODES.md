# ゲームモード仕様書

## 概要

GTRトレーニングツールには、プレイヤーのスキルレベルに応じた複数のゲームモードが用意されています。

## 実装済みモード

### 1. 初心者用ガイド付きGTR練習

#### 特徴
- GTR初心者向けの学習特化モード
- 右側にリアルタイムガイド表示（800x800px）
- 段階的な学習支援システム

#### ガイドシステム
1. **最初の2手状態**
   - 2手組み合わせパターン別のおすすめ配置表示
   - AAAA、AAAB、ABAB、ABAC、AABC型それぞれのガイド

2. **基本形作成状態** 
   - GTRの必須折り返し部分（1-3列目）の作り方
   - 10AB、11AAB、12BBの配置ガイド

3. **連鎖尾作成状態**
   - Y字形、L字形、階段形の3つの連鎖尾パターン
   - パターン別の配置サンプル表示

4. **GTR完成形作成状態**
   - 検出された連鎖尾タイプに応じた完成形サンプル
   - GTRGuidePatterns.tsから完成形を取得

#### ガイド表示仕様
- **配置**: ゲームフィールド右側（X座標380px）
- **サイズ**: フィールドと同じ高さ（13×CELL_SIZE）に揃えて表示
- **ぷよ表示**: 実際のぷよスプライト（A→赤、B→緑、C→青、D→黄）
- **背景**: 半透明の灰色背景（0x222222）と枠線

#### 学習支援機能
- **↑キー**: 1手巻き戻し機能（GameHistory管理）
- **Pキー**: ポーズ・再開機能
- **Spaceキー**: 詳細なGTR評価画面表示
- **Escキー**: TOPページに戻る

#### 評価システム
詳細なチェックボックス形式の評価結果：
- ✓ 折り返し（必須パターンの有無）
- ✓ Y字連鎖尾 / L字連鎖尾 / 階段連鎖尾
- ✓ 4連鎖 / 5連鎖
- ✓ 右上が立っている（9行目使用状況）
- ✓ あまりぷよが連結

### 2. GTRスコアアタック

#### 特徴
- 従来の5GTRモードを維持（600x800px）
- 高速ゲームプレイに特化
- インタラクティブな評価システム

#### ゲームプレイ
- 通常のぷよぷよルール
- 2手目組み合わせ制約適用
- ネクスト・ネクネクスト表示
- 壁キック機能

#### 評価機能
- **Spaceキー**: GTR評価実行
- **評価画面**: Space（続行）/ Esc（TOPへ戻る）選択
- スコア、連鎖数、メッセージ表示

## 未実装モード

### 3. フリープレイ（開発予定）

#### 予定機能
- ガイドなしでの自由なGTR練習
- 完成したGTRの自動採点
- 統計情報の表示
- プレイ履歴の記録

## 共通機能

### 基本操作
- **← →**: 左右移動
- **↓**: 高速落下
- **Z**: 左回転
- **X**: 右回転
- **Esc**: TOPページに戻る

### GTR評価システム
- GTRScoringConfig.tsによる設定値管理
- 必須折り返しパターン検出
- 連鎖尾形状判定（Y字・L字・階段）
- 9行目使用状況評価
- あまりぷよ評価（単色連結で高評価）

### 2手目組み合わせ制約
- AAAA型、AAAB型、ABAB型、ABAC型、AABC型の5種類のみ
- 4色すべてが揃うことはない現実的な制約
- 4色固定（赤・緑・青・黄）

## 技術仕様

### アーキテクチャ
- **React**: TOPページとモード管理
- **Phaser.js**: ゲームエンジン
- **独立シーン**: 各モードは独立したPhaser Scene

### ファイル構成
- `TopMenu.tsx`: メインメニューUI
- `GuidedGame.tsx`: ガイド付きモードのReactラッパー
- `ScoreAttackGame.tsx`: スコアアタックモードのReactラッパー  
- `GuidedPracticeScene.ts`: ガイド付きモードのPhaserシーン
- `PuyoGame.ts`: スコアアタック用Phaserシーン

### 状態管理
- `GuideManager.ts`: ガイド状態の遷移管理
- `GameHistory.ts`: 巻き戻し用のゲーム履歴管理
- `GTRGuidePatterns.ts`: ガイド表示用のパターンサンプル

## 今後の開発計画

### Phase 1: フリープレイモード
- ガイドなし練習モード
- 統計機能強化

### Phase 2: オンライン機能
- Supabaseとの連携
- ランキングシステム
- ユーザー認証

### Phase 3: ソーシャル機能  
- リプレイ共有
- フレンドシステム
- 実績・バッジシステム